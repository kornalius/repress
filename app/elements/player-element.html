<link rel="import" href="theme.html">

<dom-module id="player-element">

  <template>
    <style include="app-theme">
      :host {
      }
    </style>

  </template>

  <script>
    class PlayerElement extends Polymer.Element {

      static get is() { return 'player-element'; }

      static get properties () {
        return {
          name: {
            type: String,
            value: '',
          },
          stats: {
            type: Array,
            value: () => [],
          },
          items: {
            type: Array,
            value: () => [],
          },
        }
      }

      statByName (name) {
        return _.find(this.stats, { name })
      }

      incrementStat (name, value) {
        let stat = this.statByName(name)
        if (stat) {
          let v = stat.value
          v += value
          if (_.isNumber(stat.max) && v > stat.max) {
            v = stat.max
          }
          stat.value = v
          this.set('stats', _.clone(this.stats))
        }
      }

      decrementStat (name, value) {
        let stat = this.statByName(name)
        if (stat) {
          let v = stat.value
          v -= value
          if (_.isNumber(stat.min) && v < stat.min) {
            v = stat.min
          }
          stat.value = v
          this.set('stats', _.clone(this.stats))
        }
      }

      setStat (name, value) {
        let stat = this.statByName(name)
        if (stat) {
          let v = stat.value
          v -= value
          if (_.isNumber(stat.min) && v < stat.min) {
            v = stat.min
          }
          if (_.isNumber(stat.max) && v > stat.max) {
            v = stat.max
          }
          stat.value = v
          this.set('stats', _.clone(this.stats))
        }
      }

      addStat (name, value, options = {}) {
        let stat = this.statByName(name)
        if (!stat) {
          this.push('stats', {
            name,
            value,
            min: _.get(options, 'min'),
            max: _.get(options, 'max'),
            hint: _.get(options, 'hint'),
            label: _.get(options, 'label', name),
          })
        }
      }

      removeStat (name, value) {
        let stat = this.statByName(name)
        if (stat) {
          this.splice('stats', _.indexOf(this.stats, stat), 1)
        }
      }

      itemByName (name) {
        return _.find(this.items, { name })
      }

      hasItem (name) {
        return !_.isUndefined(this.itemByName(name))
      }

      addItem (name, options = {}) {
        let item = this.itemByName(name)
        if (!item) {
          this.push('items', _.extend({ name }, options))
        }
      }

      dropItem (name) {
        let item = this.itemByName(name)
        if (item) {
          this.splice('items', _.indexOf(this.items, item), 1)
        }
      }

      setItem (name, options = {}) {
        let item = this.itemByName(name)
        if (item) {
          _.extend(item, options)
          this.set('items', _.clone(this.items))
        }
      }

    }

    customElements.define(PlayerElement.is, PlayerElement);
  </script>

</dom-module>
